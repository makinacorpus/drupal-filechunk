(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)})([function(a,b,c){a.exports=c(1)},function(a,b,c){'use strict';c(2),c(3)},function(){},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0}),c(4);var d=c(5);Drupal.behaviors.filechunk={attach:function(a){if(!a.querySelectorAll)return void console.log('Given context is not a valid HTML Element, some module are probably wrongly calling Drupal.attachBehavior() using a jQuery selector');for(var b,c=0,e=a.querySelectorAll('.filechunk-widget-table');c<e.length;c++)b=e[c],b.hasAttribute('data-filechunk-init')||(b.setAttribute('data-filechunk-init','1'),new d.FilechunkWidget(b,Drupal.t))}}},function(){'use strict'},function(a,b,c){'use strict';function d(){var a=window.navigator.userAgent,b=a.indexOf('MSIE ');if(0<b)return parseInt(a.substring(b+5,a.indexOf('.',b)),10);var c=a.indexOf('Trident/');if(0<c){var d=a.indexOf('rv:');return parseInt(a.substring(d+3,a.indexOf('.',d)),10)}return null}function e(a,b){if('number'!=typeof a)if('string'!=typeof a)throw'Invalid argument, number is not a number';else if(a=parseInt(a,10),isNaN(a))throw'Invalid argument, number is not a number';if(b&&a<b)throw'Invalid argument, number must be over '+b;return a}var f='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};Object.defineProperty(b,'__esModule',{value:!0});var g=c(6),h=function(){return function(a,b){if(this.itemPreviewTemplate='<li data-fid="FID"></li>',this.removeButtonTemplate='<button class="filechunk-remove btn btn-primary" type="submit" value="Remove">\' + Drupal.t( "Remove" ) + \'</button>','file'!==a.type)throw'Input widget is not a file input';if(!a.hasAttribute('data-token'))throw'Input widget has no token set, file upload is not possible';if(!a.hasAttribute('data-uri-upload'))throw'Input widget has no upload url set, file upload is not possible';if(!a.hasAttribute('data-uri-remove'))throw'Input widget has no remove url set, file upload is not possible';var c=a.getAttribute('data-max-count');if(c)try{this.maxCount=e(c)}catch(a){console.log(a),this.maxCount=1}else this.maxCount=a.multiple?0:1;this.chunksize=e(a.getAttribute('data-chunksize')||2097152),this.endpoint=a.getAttribute('data-uri-upload'),this.fieldname=a.getAttribute('data-field-name'),this.isMultiple=a.multiple,this.itemPreviewTemplate=a.getAttribute('data-tpl-item')||'<li data-fid="FID"></li>',this.onUpdate=b,this.removeButtonTemplate=a.getAttribute('data-tpl-remove')||'<button class="filechunk-remove btn btn-primary" type="submit" value="LABEL">LABEL</button>',this.removeUrl=a.getAttribute('data-uri-remove'),this.token=a.getAttribute('data-token')}}(),i=function(){function a(a,b){var c=this;if(this.currentValue=[],!FileReader)throw'Your browser is too old, file upload is not supported';if(!a.parentElement)throw'What?';a=a.parentElement;var e=a.querySelector('input[type=file]');if(!(e instanceof HTMLInputElement))throw'Could not find the input[type=file] element';var i=a.querySelector('input[type=hidden]');if(!(i instanceof HTMLInputElement))throw'Could not find the input[type=file] element';var j=a.querySelector('.filechunk-widget-drop');if(!(j instanceof HTMLElement))throw'Could not find the drop zone';var k=a.querySelector('.preview-container');k||(k=document.createElement('ul'),k.style.display='none',k.classList.add('preview-container'),a.appendChild(k)),this.config=new h(e),this.isMSIE=null!==d(),this.translateCallback=b,this.wrapper=a,this.dropZone=j,this.inputElement=e,this.previewContainer=k,this.valueElement=i,this.errorElement=this.createElementFromString('<div class="messages error file-upload-js-error" aria-live="polite" style="display: none;"></div>'),this.dropZone.insertBefore(this.errorElement,this.dropZone.firstChild),this.progressBar=this.createElementFromString('<div class="progressbar" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="100" style="display: none;"></div>'),this.wrapper.insertBefore(this.progressBar,this.valueElement),this.inputElement.style.opacity='0',this.inputElement.style.position='absolute',this.inputElement.style.top='0',this.inputElement.style.left='0',this.inputElement.style.bottom='0',this.inputElement.style.right='0',this.inputElement.required=!1;try{var l=this.valueElement.value;if(l&&''!=l){var m=JSON.parse(this.valueElement.value);for(var n in m){var o=m[n];'object'===('undefined'==typeof o?'undefined':f(o))?this.currentValue.push(new g.Item(n,o.filename,o.hash,o.preview)):this.currentValue.push(new g.Item(o,n,o))}}}catch(a){console.log(a),this.showError(this.translate('Invalid default value'))}this.refresh(),this.inputElement.addEventListener('change',function(a){return c.onUploadChangeListener(a)}),this.inputElement.addEventListener('drop',function(a){return c.onUploadChangeListener(a)})}return a.prototype.createElementFromString=function(a){var b=document.createElement('div');if(b.innerHTML=a,!b.firstElementChild)throw'Invalid HTML input given, could not create element';return b.firstElementChild},a.prototype.translate=function(a,b){if(this.translateCallback)return this.translateCallback(a,b);var c=a;for(var d in b)c.replace(d,b[d]);return c},a.prototype.showError=function(a){this.errorElement.innerHTML=a,this.errorElement.style.display='block'},a.prototype.clearError=function(){this.errorElement.style.display='none',this.errorElement.innerHTML=''},a.prototype.refresh=function(){var a=this,b={},c=0;this.previewContainer.innerHTML='';for(var d,e=function(d){c++;var e=f.config.itemPreviewTemplate.replace('FID',d.id),g=f.createElementFromString(e);g.innerHTML=d.filename||d.hash||d.id;var h=f.config.removeButtonTemplate.replace(/LABEL/g,f.translate('Remove')),i=f.createElementFromString(h);i.addEventListener('click',function(b){b.stopPropagation(),b.preventDefault(),a.remoteRemoveCall(d.id).then(function(){for(var b=0;b<a.currentValue.length;++b)a.currentValue[b].id==d.id&&a.currentValue.splice(b,1);a.refresh()}).catch(function(b){a.showError(b),a.refresh()})}),b[d.id]={filename:d.filename,hash:d.hash},g.appendChild(i),f.previewContainer.appendChild(g)},f=this,g=0,h=this.currentValue;g<h.length;g++)d=h[g],e(d);this.previewContainer.style.display=c?'block':'none',this.valueElement.value=JSON.stringify(b)},a.prototype.updateProgress=function(a,b){var c=a.toString();this.progressBar.style.display='block',b=b||c+'%',this.progressBar.style.width=c+'%',this.progressBar.innerHTML=b,this.progressBar.setAttribute('aria-valuenow',a.toString())},a.prototype.remoteRemoveCall=function(a){var b=this;return new Promise(function(c){var d=new XMLHttpRequest;d.open('POST',b.config.removeUrl),d.setRequestHeader('X-Requested-With','XMLHttpRequest'),d.setRequestHeader('Accept','application/json'),/^[1-9]+$/.test(a)?d.setRequestHeader('X-File-Id',a):d.setRequestHeader('X-File-Id',btoa(encodeURIComponent(a))),d.setRequestHeader('X-File-Token',b.config.token),d.setRequestHeader('X-File-field',b.config.fieldname),d.overrideMimeType&&d.overrideMimeType('application/octet-stream'),d.addEventListener('load',function(){c()}),d.addEventListener('error',function(){throw d.status+': '+d.statusText+': '+d.responseText}),d.send()})},a.prototype.replaceUpload=function(){var a=this;if(this.isMSIE){var b=this.inputElement.cloneNode(!1);this.inputElement.parentElement.replaceChild(b,this.inputElement),this.inputElement=b,this.inputElement.addEventListener('change',function(b){return a.onUploadChangeListener(b)}),this.inputElement.addEventListener('drop',function(b){return a.onUploadChangeListener(b)})}else this.inputElement.value='';this.progressBar.setAttribute('aria-valuenow','0'),this.progressBar.style.display='none',this.refresh()},a.prototype.onUploadChangeListener=function(){var a=this,b=this.inputElement.files;if(!b||!b.length)return void this.replaceUpload();if(this.config.maxCount&&Object.keys(this.currentValue).length+b.length>this.config.maxCount)return this.showError(this.translate('A maximum of @count elements is allowed',{"@count":this.config.maxCount})),void this.replaceUpload();this.updateProgress(0);for(var c,d=0;d<b.length;++d)c=b[d],this.showError(this.translate('Uploading file @file...',{"@file":c.name})),g.upload(c,this.config).then(function(b){a.currentValue.push(b),a.clearError(),a.replaceUpload()}).catch(function(b){a.showError(b),console.log(b),a.replaceUpload()})},a}();b.FilechunkWidget=i},function(a,b){'use strict';function c(a,b,e){void 0===e&&(e=0);var f=b.chunksize,g=Math.min(e+f,a.size);return new Promise(function(f,h){var i=new XMLHttpRequest;i.open('POST',b.endpoint),i.setRequestHeader('Accept','application/json'),i.setRequestHeader('Content-Range','bytes '+e+'-'+g+'/'+a.size),i.setRequestHeader('Content-type','application/octet-stream'),i.setRequestHeader('X-File-field',b.fieldname||'none'),i.setRequestHeader('X-File-Name',btoa(encodeURIComponent(a.name))),i.setRequestHeader('X-File-Token',b.token),i.setRequestHeader('X-Requested-With','XMLHttpRequest'),i.overrideMimeType&&i.overrideMimeType('application/octet-stream'),i.addEventListener('loadend',function(){try{var e=JSON.parse(i.responseText);if(200!==i.status)throw e.message||'error: '+i.status+' '+i.statusText;else if(a.size<=g||e.finished){if(!e.fid||!e.hash)throw'File could not be completely uploaded';b.onUpdate&&b.onUpdate(100),f(new d(e.fid,a.name,e.hash,e.preview))}else{if(b.onUpdate){var j=e.offset;b.onUpdate(100*Math.round(j/a.size))}e.resume&&e.offset?f(c(a,b,e.offset)):f(c(a,b,g))}}catch(a){h(a)}}),i.send(a.slice(e,g))})}Object.defineProperty(b,'__esModule',{value:!0});var d=function(){return function(a,b,c){this.id=a,this.filename=b,this.hash=c||null,this.preview=c||null}}();b.Item=d,b.upload=function(a,b){return c(a,b)}}]);